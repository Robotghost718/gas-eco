<script>
/* global app modal */
app.pages.loading = {
  elements: {
    container: document.querySelector('div.loadingContainer'),
    roster: document.querySelector('#loadingRoster'),
    inventory: document.querySelector('#loadingInventory'),
    openForms: document.querySelector('#loadingOpenForms'),
    rosterStatus: document.querySelector('#loadingRosterStatus'),
    inventoryStatus: document.querySelector('#loadingInventoryStatus'),
    openFormsStatus: document.querySelector('#loadingOpenFormsStatus'),
  },
  handleTimeout: function() {
    modal(app.pages.loading.timeoutMessage);
    app.pages.loading.timeoutId = null;
  },
  hide: function() {
    if (this.timeoutId !== null) {
      window.clearTimeout(this.timeoutId);
    }
    this.timeoutId = null;
    this.elements.container.classList.add("hidden");
    ['roster', 'inventory', 'openForms'].forEach(key => {
      const el = this.elements[key];
      el.textContent = el.textContent.replace(" downloaded", "");
    });
  },
  isShowing: function() {
    return ! this.elements.container.classList.contains("hidden");
  },
  setTimeout: function() {
    this.timeoutId = window.setTimeout(this.handleTimeout, 10000);
  },
  show: function() {
    this.setTimeout();
    this.elements.container.classList.remove("hidden");
  },
  timeoutId: null,
  timeoutMessage: "Looks like the server is taking a long time. " +
    "Paper forms are available either in the filing cabinet at the desk " +
    "or look for \"Equipment Checkout Form.pdf\" on your computer.",
};
</script>
