<script>
  /* global Omnibox FormPage OpenFormsPage */
  /**
   * signature of the app object
   */
  const app = {
    doCommand: function (/* command, ...options */) {}, // command switch block
    elements: {}, // top level elements e.g. global navigation
    errors: [], // error stack to ensure all errors get displayed to user
    handlers: {}, // event methods
    modal: {}, // the modal pop up window
    pages: {}, // the different single page views
    refresh: function (/* response */) {}, // server callback switch block
    run: null, // defined in jsInit, main server call
    showPage: function (/* page */) {}, // shows a single view to the user
    strings: {}, // top level strings
    withErrorHandler: null, // defined in jsInit, main server error handler
  };

  app.pages = {
    // must have show and hide functions
    archive: {},
    FormPage,
    loading: {},
    OpenFormsPage,
  };

  app.showPage = function (page) {
    for (const key in app.pages) {
      if (page == app.pages[key]) {
        page.show();
      } else {
        app.pages[key].hide();
      }
    }
  };

  app.strings = {
    formstack: {
      archive: "archive",
      openForms: "openForms",
    },
  };

  /**
   * tryUnlock controls when the loading page switches to the open forms page
   */
  app.tryUnlock = function () {
    const rosterLength = Omnibox.getRoster().length,
      inventoryLength = Omnibox.getInventory().getLength(),
      stackInit = OpenFormsPage.getStack().isInitialized();
    if (rosterLength > 1) {
      app.pages.loading.elements.rosterStatus.textContent =
        "" + rosterLength + " people downloaded";
    }
    if (inventoryLength > 1) {
      app.pages.loading.elements.inventoryStatus.textContent =
        "" + inventoryLength + " items downloaded";
    }
    if (stackInit) {
      app.pages.loading.elements.openFormsStatus.textContent = "downloaded";
    }
    if (rosterLength < 1 || inventoryLength < 1 || !stackInit) {
      return false;
    }
    app.elements.openFormsButton.removeAttribute("disabled");
    app.elements.newFormButton.removeAttribute("disabled");
    app.showPage(OpenFormsPage);
    return true;
  };
</script>
