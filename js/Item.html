<script>
/* exported  Item */
function Item(obj) {
  this.barcode = obj.barcode;        // {string}
  this.id = obj.id;                  // {string}
  this.checkedOut = obj.checkedOut;  // {bool}
  this.checkIn = obj.checkIn;        // {string} formatted date
  this.checkOut = obj.checkOut;      // {string} formatted date
  this.description = obj.description;// {string} make, model, etc
  this.quantity = obj.quantity;      // {int}
  this.notes = obj.notes;            // {string} saves the notes for the item
  this.missing = obj.missing;        // {bool} true if item cannot be found when form is closed


  this.getId = function() { return this.id; };
  this.getQuantity = function() { return this.quantity; };
  this.getDescription = function() { return this.description; };
  this.getStripped = function() {
    return {
      id: this.id,
      description: this.description,
      quantity: this.quantity,
      barcode: this.barcode
    };
  };

  this.isCheckedOut = function() { return this.checkedOut; };

  this.incrementQuantity = function() {
    if (this.serialized) {
      throw new Error(
        this.id + " is serialized and cannot have the quantity changed."
      );
    } else {
      this.quantity++;
      return this;
    }
  };

  this.decrementQuantity = function () {
    if (this.serialized) {
      throw new Error(
        this.id + " is serialized and cannot have quantity changed"
      );
    } else if (this.quantity == 1) {
      throw new Error(
        this.id + " cannot have quantity less than 1"
      );
    } else {
      this.quantity--;
      return this;
    }
  };

  this.setQuantity = function(integer) {
    if (this.serialized && integer != 1) {
      throw new Error("Cannot change quantity of a serialized item");
    } else {
      if (isNaN(integer) ||
          integer != Math.floor(integer) ||
          integer != Math.abs(integer)) {
        throw new Error(
          "Invalid quantity: " + integer + ". Use a positive number.  " +
          "Scan the item to check-in."
        );
      }
      this.quantity = integer;
      return this;
    }
  };

  this.setBarcode = function(str) { this.barcode = str; return this; };
  this.setDescription = function(str) { this.description = str; return this; };
  this.setCheckedOut = function(bool) { this.checkedOut = Boolean(bool); return this; };
  this.setSerialized = function() { // TODO bug: do not run this before setting barcode!!
    if (! this.barcode ) {
      this.serialized = false;
    }
    if (+this.barcode > 9999 && +this.barcode < 10101) { // reserved barcode range TODO put in config settings
      this.serialized = false;
    } else {
      this.serialized = true;
    }
    return this;
  };
}
</script>
