<script>
  /* exported Inventory */
  /** Utilities for Item[], all params named `items` are Item[] */
  const Inventory = (function () {
    return {
      contains,
      getByBarcode,
      getById,
      getByItem,
      getStripped,
      removeByItem,
      archive,
    };
    function contains(items, query) {
      query = query.replace(/\s/g, "").replace(/-0+/, "-");
      return items.find((item) => {
        const id = item.id.replace(/\s/g, "").replace(/-0+/, "-");
        return query === id || item.description.toUpperCase().includes(query);
      });
    }
    function getByBarcode(items, barcode) {
      return items.find((item) => {
        if (!item.barcode) {
          return false;
        }
        return item.barcode.toLowerCase() == barcode;
      });
    }
    function getById(items, id) {
      id = id.toLowerCase().replace(/-0+/, "-");
      return items.find((item) => {
        if (!item.id) {
          return false;
        }
        return item.id.toLowerCase().replace(/-0+/, "-") === id;
      });
    }
    function getByItem(items, item) {
      return items.find((i) => {
        if (i.id && i.id == item.id) {
          return true;
        }
        if (i.barcode && i.barcode == item.barcode) {
          return true;
        }
        return false;
      });
    }
    function getStripped(items) {
      const copy = [];
      items.forEach((item) => {
        copy.push({
          id: item.id,
          description: item.description,
          quantity: item.quantity,
          barcode: item.barcode,
        });
      });
      return copy;
    }
    function removeByItem(items, { barcode, id }) {
      const index = items.findIndex((item) => {
        if (item.id && item.id == id) {
          return true;
        }
        if (item.barcode && item.barcode == barcode) {
          return true;
        }
        return false;
      });
      return items.splice(index, 1)[0];
    }
    function archive(items) {
      const copy = [];
      items.forEach((item) => copy.push(item.archive()));
      return copy;
    }
  })();
</script>
