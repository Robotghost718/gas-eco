<script>
  /* global HTML Utility OpenFormsTable EquipmentOutTable */
  /* exported OpenFormsPage */
  function OpenFormsPage({ openForms, setForm, setOpenForms }) {
    const { createElement, documentIcon, headerCell, page, row, table } = HTML;
    const { compareStrings, sort, uncamelCase } = Utility;
    return page({
      name: "openForms",
      children: [
        createElement("h2", { textContent: "Open Forms" }),
        createElement("h3", {
          textContent: "click on a form to view and edit",
        }),
        table(
          createElement("thead", {
            class: "open",
            children: [
              headerCell({ child: documentIcon() }),
              ...["startTime", "endTime", "location", "students"].map((text) =>
                createElement("th", {
                  onClick: (_, el) => {
                    el.classList.add("sortedBy", "ascending");
                    sortFormsBy(text);
                  },
                  textContent: uncamelCase(text),
                })
              ),
            ],
          }),
          OpenFormsTable({ openForms, setForm })
        ),
        createElement("h2", { textContent: "Equipment Checked Out" }),
        table(
          createElement("thead", {
            class: "equipmentOut",
            child: row(
              ...["Item", "Id", "Location", "Students", "End Time"].map(
                headerCell
              )
            ),
          }),
          EquipmentOutTable({ openForms, setForm })
        ),
      ],
    });

    function sortFormsBy(text) {
      var fn;
      switch (text) {
        case "startTime":
          fn = ({ startTime: a }, { startTime: b }) =>
            new Date(a) - new Date(b);
          break;
        case "endTime":
          fn = ({ endTime: a }, { endTime: b }) => new Date(a) - new Date(b);
          break;
        case "location":
          fn = ({ location: a }, { location: b }) => compareStrings(a, b);
          break;
        case "students": {
          const getNames = (names, { name }) => [...names, name];
          fn = ({ students: a }, { students: b }) =>
            compareStrings(
              a.reduce(getNames, []).join(", "),
              b.reduce(getNames, []).join(", ")
            );
          break;
        }
      }
      setOpenForms(sort(openForms, fn));
    }
  }
</script>
