<script>
  /* global HTML */
  /* exported LoadingPage */
  const LoadingPage = (function () {
    const elements = {
      container: document.querySelector("div.loadingContainer"),
      roster: document.querySelector("#loadingRoster"),
      inventory: document.querySelector("#loadingInventory"),
      openForms: document.querySelector("#loadingOpenForms"),
      rosterStatus: document.querySelector("#loadingRosterStatus"),
      inventoryStatus: document.querySelector("#loadingInventoryStatus"),
      openFormsStatus: document.querySelector("#loadingOpenFormsStatus"),
    };
    let timeoutId = null;

    return { show, hide, isShowing, updateStatus };

    function updateStatus(key, value) {
      if (key in elements) elements[key].textContent = value;
    }

    function handleTimeout() {
      if (timeoutId == null) {
        return;
      }
      HTML.modal({
        child: HTML.paragraph(
          "Looks like the server is taking a long time. " +
            "Paper forms are available either in the filing cabinet at the desk " +
            'or look for "Equipment Checkout Form.pdf" on your computer.'
        ),
      });
      timeoutId = null;
    }
    function hide() {
      if (timeoutId !== null) {
        window.clearTimeout(timeoutId);
      }
      timeoutId = null;
      elements.container.classList.add("hidden");
      ["roster", "inventory", "openForms"].forEach((key) => {
        const el = elements[key];
        el.textContent = el.textContent.replace(" downloaded", "");
      });
    }
    function isShowing() {
      return !elements.container.classList.contains("hidden");
    }
    function setTimeout() {
      timeoutId = window.setTimeout(handleTimeout, 10000);
    }
    function show() {
      setTimeout();
      elements.container.classList.remove("hidden");
    }
  })();
</script>
